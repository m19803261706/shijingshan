# PRD: 临床科室整改提交

## 基本信息

- **项目**: shijingshan
- **功能**: 临床科室整改提交
- **创建时间**: 2025-12-19
- **框架**: JeecgBoot 3.8.x

## 功能概述

为临床科室人员提供统一的整改提交页面，支持查看和处理来自不同职能科室（药剂科、护理部、医务科等）下发的整改任务。

### 核心目标

1. **统一入口**：临床人员在一个页面查看所有需要整改的事项
2. **分类展示**：通过 Tab 页签区分不同来源的整改任务
3. **可扩展性**：设计支持后续添加更多科室类型（护理部、医务科等）

### 用户角色

- **临床科室人员**：查看整改要求、填写整改措施、提交整改结果

## 业务流程

### 整改提交流程

```
┌────────────────┐     ┌────────────────┐     ┌────────────────┐
│  职能科室下发   │ ──▶ │  临床人员填写   │ ──▶ │  职能科室确认   │
│  整改要求      │     │  整改措施       │     │  整改结果       │
└────────────────┘     └────────────────┘     └────────────────┘
       │                      │                      │
       ▼                      ▼                      ▼
  pending_rectify        rectifying               closed
  (待整改)               (整改中)                (已结案)
```

### 状态说明

| 状态 | 说明 | 可操作 |
|------|------|--------|
| pending | 待整改 - 职能科室已下发要求 | 填写整改、保存草稿 |
| submitted | 已提交 - 临床人员已提交整改 | 查看 |
| approved | 已通过 - 职能科室确认通过 | 查看 |
| rejected | 已退回 - 需再次整改 | 重新填写整改 |

## 页面设计

### 整体布局

```
┌─────────────────────────────────────────────────────────────┐
│  临床科室整改提交                                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ 药品不良反应 │ │ 护理部(预留) │ │ 医务科(预留) │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐ │
│  │                   搜索条件栏                          │ │
│  │  [报告编号] [患者姓名] [整改状态▼] [查询] [重置]      │ │
│  └───────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐ │
│  │                   数据列表                            │ │
│  │  报告编号 | 患者姓名 | 不良反应 | 整改要求 | 期限 | 操作│ │
│  │  ───────────────────────────────────────────────────  │ │
│  │  ADR-001 | 张三    | 皮疹     | 需整改.. | 12-25 | [操作]│ │
│  │  ADR-002 | 李四    | 头晕     | 需整改.. | 12-26 | [操作]│ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Tab 页签配置

| Tab | 名称 | 数据来源 | 当前状态 |
|-----|------|----------|----------|
| drug | 药品不良反应 | drug_adverse_rectify | 已开发 |
| nursing | 护理部 | 待定 | 预留 |
| medical | 医务科 | 待定 | 预留 |

### 操作按钮

| 按钮 | 条件 | 说明 |
|------|------|------|
| 查看详情 | 所有状态 | 查看原报告和整改要求 |
| 整改历史 | 所有状态 | 查看历史整改记录 |
| 填写整改 | pending/rejected | 填写整改措施并提交 |

## 数据设计

### 现有数据结构

#### 药品不良反应整改 (drug_adverse_rectify) - 已存在

```sql
-- 已在 V1019__drug_process.sql 创建
-- 核心字段：
-- report_id, requirement, deadline, measures, completion, status
```

### API 设计

#### 新增 API

| 方法 | 路径 | 说明 | 权限 |
|------|------|------|------|
| GET | /adverse/clinic/rectify/drugList | 药品不良反应待整改列表 | adverse:clinicRectify:view |
| GET | /adverse/clinic/rectify/drugDetail | 查看整改详情 | adverse:clinicRectify:view |
| POST | /adverse/clinic/rectify/drugSubmit | 提交药品整改 | adverse:clinicRectify:submit |
| GET | /adverse/clinic/rectify/drugHistory | 获取整改历史 | adverse:clinicRectify:view |

### 后端实现方案

由于整改数据结构不同（药品不良反应、护理事件等各有自己的表），采用 **接口适配器模式**：

```java
// 统一整改项接口
public interface RectifyItem {
    String getId();           // 整改ID
    String getReportId();     // 关联报告ID
    String getReportType();   // 报告类型：drug/nursing/medical
    String getTitle();        // 显示标题
    String getRequirement();  // 整改要求
    Date getDeadline();       // 整改期限
    String getStatus();       // 整改状态
}

// 药品不良反应整改适配器
public class DrugRectifyAdapter implements RectifyItem { ... }

// 后续扩展：护理整改适配器
public class NursingRectifyAdapter implements RectifyItem { ... }
```

## 前端页面

### 文件结构

```
views/adverse/clinic-rectify/
├── index.vue                    # 主页面（Tab 容器）
├── components/
│   ├── DrugRectifyList.vue     # 药品不良反应整改列表
│   ├── RectifyDetailModal.vue  # 整改详情弹窗
│   ├── RectifyFormModal.vue    # 整改表单弹窗
│   └── RectifyHistoryModal.vue # 整改历史弹窗
└── data/
    └── rectify.data.ts         # 表格配置
```

### 路由配置

```typescript
{
  path: 'clinic-rectify',
  name: 'AdverseClinicRectify',
  component: () => import('/@/views/adverse/clinic-rectify/index.vue'),
  meta: {
    title: '临床科室整改',
    icon: 'ant-design:edit-outlined',
  },
}
```

## 菜单权限

### 菜单结构

```
不良事件管理 (ae_root)
├── ...
├── 临床科室审核 (ae_clinic_audit)
├── 临床科室整改 (ae_clinic_rectify)  <-- 新增
│   ├── 查看 (ae_clinic_rectify_view)
│   └── 提交整改 (ae_clinic_rectify_submit)
├── 药品科室处理 (ae_drug_process)
└── ...
```

### 权限码

| 权限ID | 名称 | 权限码 |
|--------|------|--------|
| ae_clinic_rectify | 临床科室整改 | - |
| ae_clinic_rectify_view | 查看 | adverse:clinicRectify:view |
| ae_clinic_rectify_submit | 提交整改 | adverse:clinicRectify:submit |

## 开发任务拆分

### Phase 1: 后端开发
- [ ] 创建 ClinicRectifyController 控制器
- [ ] 实现药品不良反应整改列表查询
- [ ] 实现整改提交接口

### Phase 2: 前端开发
- [ ] 创建主页面 index.vue（Tab 容器）
- [ ] 创建 DrugRectifyList.vue 列表组件
- [ ] 创建整改表单弹窗组件
- [ ] 配置 API 接口
- [ ] 添加路由配置

### Phase 3: 权限配置
- [ ] 创建菜单 SQL
- [ ] 配置权限分配

## 扩展性设计

### 添加新科室类型的步骤

1. **数据库**：创建新的整改表（如 nursing_rectify）
2. **后端**：创建适配器实现 RectifyItem 接口
3. **前端**：新增 Tab 页签和对应的列表组件
4. **配置**：在配置表中注册新的科室类型

### 配置驱动（可选优化）

后续可引入配置表驱动 Tab 显示：

```sql
-- 科室整改类型配置表（预留）
CREATE TABLE rectify_type_config (
  id VARCHAR(32) PRIMARY KEY,
  type_code VARCHAR(32) NOT NULL,      -- drug/nursing/medical
  type_name VARCHAR(100) NOT NULL,     -- 药品不良反应/护理部/医务科
  table_name VARCHAR(100) NOT NULL,    -- 整改表名
  api_prefix VARCHAR(100) NOT NULL,    -- API 前缀
  sort_order INT DEFAULT 0,            -- 排序
  enabled TINYINT DEFAULT 1            -- 是否启用
);
```

## 验收标准

- [ ] 临床人员可以在统一页面查看所有待整改任务
- [ ] Tab 切换可以筛选不同科室类型的整改
- [ ] 可以查看整改详情和历史记录
- [ ] 可以填写整改措施并提交
- [ ] 提交后状态正确更新
- [ ] 权限控制正常工作

---
> JeecgBoot PRD 文档
> 创建时间: 2025-12-19
> 使用命令: /jeecg:plan 进行任务规划
